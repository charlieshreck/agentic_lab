apiVersion: v1
kind: ConfigMap
metadata:
  name: keep-workflows
  namespace: keep
  labels:
    app.kubernetes.io/name: keep
    app.kubernetes.io/component: workflows
data:
  # Incident pipeline: Keep correlates alerts into incidents via correlation rules,
  # then forwards incidents to LangGraph for Coroot enrichment and mobile triage.
  # LangGraph fetches full incident details (including alerts) from Keep API.
  forward-incidents.yaml: |
    workflow:
      id: forward-incidents-to-langgraph
      description: Forward incidents to LangGraph for enrichment and mobile triage
      triggers:
        - type: incident
          events:
            - created
            - updated
      actions:
        - name: notify-langgraph
          provider:
            type: webhook
            config: "{{ providers.langgraph }}"
            with:
              url: "http://langgraph.ai-platform.svc.cluster.local:8000/keep-incident"
              method: POST
              body:
                incident_id: "{{ incident.id }}"
                incident_name: "{{ incident.user_generated_name }}"
                status: "{{ incident.status }}"
                severity: "{{ incident.severity }}"
                alerts_count: "{{ incident.alerts_count }}"
                creation_time: "{{ incident.creation_time }}"
                event: "{{ trigger.event }}"
